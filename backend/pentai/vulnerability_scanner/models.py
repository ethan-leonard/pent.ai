from django.db import models
import uuid

class Scan(models.Model):
    """Stores information about a vulnerability scan"""
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    target_url = models.URLField()
    start_time = models.DateTimeField(auto_now_add=True)
    end_time = models.DateTimeField(null=True, blank=True)
    status = models.CharField(
        max_length=20,
        choices=[
            ('pending', 'Pending'),
            ('in_progress', 'In Progress'),
            ('completed', 'Completed'),
            ('failed', 'Failed')
        ],
        default='pending'
    )
    
    def __str__(self):
        return f"Scan of {self.target_url} ({self.status})"

class Vulnerability(models.Model):
    """Stores information about a detected vulnerability"""
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    scan = models.ForeignKey(Scan, related_name='vulnerabilities', on_delete=models.CASCADE)
    name = models.CharField(max_length=255)
    description = models.TextField()
    url = models.URLField()
    risk = models.CharField(
        max_length=20,
        choices=[
            ('info', 'Informational'),
            ('low', 'Low'),
            ('medium', 'Medium'),
            ('high', 'High'),
            ('critical', 'Critical')
        ],
        default='info'
    )
    confidence = models.CharField(
        max_length=20,
        choices=[
            ('low', 'Low'),
            ('medium', 'Medium'),
            ('high', 'High')
        ],
        default='low'
    )
    
    def __str__(self):
        return f"{self.name} - {self.risk} risk ({self.scan.target_url})"